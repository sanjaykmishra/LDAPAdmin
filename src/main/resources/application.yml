spring:
  application:
    name: ldap-admin

  datasource:
    url:                   ${DB_URL:jdbc:postgresql://localhost:5432/ldapadmin}
    username:              ${DB_USERNAME:ldapadmin}
    password:              ${DB_PASSWORD:ldapadmin}
    driver-class-name:     org.postgresql.Driver
    hikari:
      minimum-idle:        ${DB_POOL_MIN:2}
      maximum-pool-size:   ${DB_POOL_MAX:20}
      connection-timeout:  ${DB_POOL_CONNECT_TIMEOUT_MS:30000}
      idle-timeout:        ${DB_POOL_IDLE_TIMEOUT_MS:600000}
      pool-name:           LDAPAdminHikariPool

  jpa:
    hibernate:
      # Flyway owns the schema; Hibernate only validates that entities match.
      ddl-auto: validate
    show-sql: false
    open-in-view: false
    properties:
      hibernate:
        format_sql:          false
        jdbc:
          time_zone:         UTC
        # Enable JSONB support via Hibernate 6 native JSON type mapping.
        type:
          preferred_uuid_jdbc_type: VARCHAR

  flyway:
    enabled:              true
    locations:            classpath:db/migration
    baseline-on-migrate:  false
    validate-on-migrate:  true

  servlet:
    multipart:
      max-file-size:    ${UPLOAD_MAX_FILE_SIZE:10MB}
      max-request-size: ${UPLOAD_MAX_REQUEST_SIZE:10MB}

# ── Application-specific properties ──────────────────────────────────────────
app:
  encryption:
    # 32-byte AES-256 key, base64-encoded.  REQUIRED — no default.
    key: ${ENCRYPTION_KEY}

  bootstrap:
    superadmin:
      username: ${BOOTSTRAP_SUPERADMIN_USERNAME:superadmin}
      # REQUIRED on fresh install; no default.
      password: ${BOOTSTRAP_SUPERADMIN_PASSWORD}

  jwt:
    # Long random secret, base64-encoded.  REQUIRED — no default.
    secret:          ${JWT_SECRET}
    expiry-minutes:  ${JWT_EXPIRY_MINUTES:60}

  cookie:
    # Set to false only in local development (plain HTTP).  Always true in production.
    secure: ${COOKIE_SECURE:true}

# ── Logging ───────────────────────────────────────────────────────────────────
# JSON format is configured in logback-spring.xml.
# Log level is controlled via environment variable only.
logging:
  level:
    root:             ${LOG_LEVEL:INFO}
    com.ldapadmin:    ${APP_LOG_LEVEL:INFO}
    # Suppress Hibernate SQL noise in non-debug environments
    org.hibernate.SQL: ${HIBERNATE_LOG_LEVEL:WARN}

# ── Actuator ──────────────────────────────────────────────────────────────────
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: when-authorized
